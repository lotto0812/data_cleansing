# 住所正規化システム

## 概要
このシステムは日本の住所を正規化し、市区町村合併に対応した最新の住所表記に変換するツールです。平成11年以降の市区町村合併データに対応しており、2,164件の市区町村データを処理できます。

## 主な機能
- 旧市区町村名から新市区町村名への自動変換
- 政令指定都市の特別処理（都道府県名の保持）
- スペース処理（不要なスペースの削除）
- 合併履歴の記録と最新情報の使用
- テスト結果の自動出力（テキストおよびJSON形式）

## ファイル構成
- `normalize_address.py`: 住所正規化の主要機能を提供
- `test_normalizer_comprehensive.py`: 包括的なテストケースと結果出力機能
- `市区町村マッピング.json`: 市区町村合併データ（2,114件の一意なマッピング）

## 使用方法

### 基本的な使用方法
```python
from normalize_address import AddressNormalizer

# 正規化器のインスタンスを作成
normalizer = AddressNormalizer('市区町村マッピング.json')

# 住所を正規化
normalized_address, changes = normalizer.normalize('長崎県西彼杵郡多良見町下郡1234')
print(normalized_address)  # 出力: 諫早市下郡1234
```

### テストの実行
```python
python test_normalizer_comprehensive.py
```
テスト結果は以下のファイルに出力されます：
- `test_results.txt`: 人が読みやすい形式のテスト結果
- `test_results.json`: プログラムで処理可能なJSON形式のテスト結果

## 制限事項
- 番地・建物名は正規化の対象外です
- 都道府県名は必須です
- 分割された市区町村は最新の合併先のみ使用します

## データ特性
- 2,114件の一意な市区町村マッピング
- 50件の重複（同じ市での複数回の合併）
- 例：豊川市（平成18年、20年、22年の3回の合併）

## テストケース
システムは以下のような様々なケースに対応しています：
- 基本的な市町村合併
- 政令指定都市の処理
- 複数回合併した市の処理
- 特殊なケース（分割された村など）
- スペースや全角文字を含む住所
- エッジケース（空文字列、都道府県名なし）
- 建物名やフロア情報を含む複雑な住所

## 更新履歴
- 2024年3月: テスト結果の自動出力機能を追加
- 2024年3月: 包括的なテストケースの実装
- 2024年3月: 市区町村合併データの実装（平成11年以降）
